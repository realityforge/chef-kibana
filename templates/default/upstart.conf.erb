# !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
# !! Managed by Chef, do not edit !!
# !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
description "Kibana Server"

start on filesystem or runlevel [2345]
stop on runlevel [!2345]

<% if @recent_upstart %>
setuid <%= @user %>
setgid <%= @group %>
<% end %>
respawn limit 15 5
umask 0077

pre-start script
  test -d <%= @base_dir %> || { stop; exit 0; }
end script

chdir <%= @base_dir %>
<%
  command = case @version
            when /^5/
              "#{@bin_path}/kibana/kibana #{@options}"
            when /^4/
              "#{@bin_path}/kibana #{@options}"
            end
  if node['kibana']['port'] < 1024
    command = "/usr/bin/authbind --deep " + command
  end
%>

<% if @recent_upstart %>
exec <%= command %>
<% else %>
exec su -s /bin/sh -c 'exec "$0" "$@"' <%= @user %> -- <%= command %>
<% end %>
